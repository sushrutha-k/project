<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | Helping Hands</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      display: flex;
      min-height: 100vh;
      flex-direction: column;
    }

    .auth-header {
      background: linear-gradient(rgba(74, 111, 165, 0.8), rgba(22, 96, 136, 0.9)), url('https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 4rem 0;
      margin-bottom: 3rem;
      text-align: center;
    }

    .auth-card {
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .card-header {
      background-color: #4a6fa5;
      color: white;
      font-weight: bold;
      text-align: center;
      border-radius: 10px 10px 0 0;
    }

    .btn-auth {
      background-color: #4a6fa5;
      color: white;
    }

    .btn-auth:hover {
      background-color: #166088;
    }

    .password-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      cursor: pointer;
    }

    .invalid-feedback {
      display: none;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-md navbar-dark bg-primary sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html"><i class="fas fa-hands-helping mr-2"></i>Helping Hands</a>
    </div>
  </nav>

  <!-- Header -->
  <header class="auth-header">
    <h1 class="display-4">Welcome Back</h1>
    <p class="lead">Sign in to continue your donations</p>
  </header>

  <!-- Login Form -->
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card auth-card">
          <div class="card-header">Login to Your Account</div>
          <div class="card-body">
            <form id="loginForm">
              <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" class="form-control" id="loginEmail" required />
                <div class="invalid-feedback">Enter a valid email</div>
              </div>

              <div class="form-group">
                <label for="loginPassword">Password</label>
                <div class="password-container">
                  <input type="password" class="form-control" id="loginPassword" required />
                  <span class="password-toggle" id="togglePassword"><i class="far fa-eye"></i></span>
                </div>
                <div class="invalid-feedback">Enter your password</div>
              </div>

              <button type="submit" class="btn btn-auth btn-block mt-3">
                <i class="fas fa-sign-in-alt mr-2"></i>Login
              </button>
            </form>

            <div class="text-center mt-3">
              <p>Don't have an account? <a href="register.html">Register here</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    $(document).ready(function () {
      // Show/hide password
      $("#togglePassword").click(function () {
        const input = $("#loginPassword");
        const icon = $(this).find("i");
        const type = input.attr("type") === "password" ? "text" : "password";
        input.attr("type", type);
        icon.toggleClass("fa-eye fa-eye-slash");
      });

      // Submit login
      $("#loginForm").submit(function (e) {
        e.preventDefault();

        const email = $("#loginEmail").val().trim();
        const password = $("#loginPassword").val().trim();

        // Reset errors
        $(".is-invalid").removeClass("is-invalid");
        $(".invalid-feedback").hide();

        let valid = true;
        if (!email) {
          $("#loginEmail").addClass("is-invalid").next().show();
          valid = false;
        }
        if (!password) {
          $("#loginPassword").addClass("is-invalid").next().show();
          valid = false;
        }
        if (!valid) return;

        fetch("/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        })
          .then(async (res) => {
            const data = await res.json();
            if (!res.ok) throw new Error(data.msg || "Login failed");

            // âœ… Save token & user
            localStorage.setItem("token", data.token);
            localStorage.setItem("user", JSON.stringify(data.user));

            // Redirect to homepage
            window.location.href = "index.html";
          })
          .catch((err) => {
            alert("Login failed: " + err.message);
          });
      });
    });
  </script>
</body>
</html>
